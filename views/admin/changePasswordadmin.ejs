<!DOCTYPE html>
<html lang="id">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Ganti Password Admin</title>
		<script src="https://cdn.tailwindcss.com"></script>
		<link
			href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
			rel="stylesheet"
		/>
		<style>
			body {
				font-family: 'Inter', sans-serif;
			}
		</style>
	</head>
	<body class="bg-gray-100">
		<%- include('../components/sidebar') %>
		<div class="ml-64 min-h-screen p-6">
			<div class="max-w-3xl mx-auto">
				<div class="bg-white border border-gray-200 rounded-3xl shadow-xl overflow-hidden">
					<div class="px-8 py-6 border-b border-gray-100 bg-gradient-to-r from-green-50 to-white">
						<h1 class="text-2xl font-bold text-gray-900">Ganti Password Admin</h1>
						<p class="text-sm text-gray-500 mt-1">
							Perbarui password akun administrator Anda secara berkala untuk menjaga keamanan.
						</p>
					</div>

					<div class="px-8 py-6">
						<% if (typeof success !== 'undefined') { %>
							<div
								id="popup-success"
								class="mb-5 rounded-xl border border-green-200 bg-green-50 px-4 py-3 text-green-700 shadow"
							>
								<%= success %>
							</div>
							<script>
								setTimeout(() => {
									const el = document.getElementById('popup-success');
									if (el) el.style.display = 'none';
								}, 3500);
							</script>
						<% } %>

						<% if (typeof error !== 'undefined') { %>
							<div
								id="popup-error"
								class="mb-5 rounded-xl border border-red-200 bg-red-50 px-4 py-3 text-red-700 shadow"
							>
								<%= error %>
							</div>
							<script>
								setTimeout(() => {
									const el = document.getElementById('popup-error');
									if (el) el.style.display = 'none';
								}, 3500);
							</script>
						<% } %>

						<form id="adminChangePasswordForm" action="/admin/changePassword" method="POST" class="space-y-5">
							<div>
								<label
									for="old_password"
									class="mb-1 block text-sm font-semibold text-gray-700"
								>Password Lama</label>
								<input
									type="password"
									id="old_password"
									name="old_password"
									required
									autocomplete="current-password"
									class="w-full rounded-2xl border-2 border-gray-200 bg-white px-4 py-3 text-gray-900 placeholder-gray-400 focus:border-green-500 focus:outline-none focus:ring-4 focus:ring-green-100"
									placeholder="Masukkan password lama"
								/>
							</div>

							<div>
								<label
									for="password"
									class="mb-1 block text-sm font-semibold text-gray-700"
								>Password Baru</label>
								<input
									type="password"
									id="password"
									name="password"
									required
									autocomplete="new-password"
									class="w-full rounded-2xl border-2 border-gray-200 bg-white px-4 py-3 text-gray-900 placeholder-gray-400 focus:border-green-500 focus:outline-none focus:ring-4 focus:ring-green-100"
									placeholder="Minimal 8 karakter, kombinasi huruf, angka, simbol"
								/>
							</div>

							<div>
								<label
									for="confirm_password"
									class="mb-1 block text-sm font-semibold text-gray-700"
								>Konfirmasi Password Baru</label>
								<input
									type="password"
									id="confirm_password"
									name="confirm_password"
									required
									autocomplete="new-password"
									class="w-full rounded-2xl border-2 border-gray-200 bg-white px-4 py-3 text-gray-900 placeholder-gray-400 focus:border-green-500 focus:outline-none focus:ring-4 focus:ring-green-100"
									placeholder="Ulangi password baru"
								/>
								<p
									id="match-error"
									class="mt-2 hidden text-sm font-semibold text-red-600"
								>Password baru dan konfirmasi belum cocok.</p>
							</div>

							<button
								type="submit"
								class="w-full rounded-2xl bg-gradient-to-r from-green-500 to-green-600 px-6 py-3 text-lg font-semibold text-white shadow-lg transition-all duration-200 hover:from-green-600 hover:to-green-700 hover:shadow-xl focus:outline-none focus:ring-4 focus:ring-green-200 disabled:cursor-not-allowed disabled:opacity-60"
							>
								Simpan Password Baru
							</button>
						</form>
					</div>
				</div>
			</div>
		</div>

		<script>
			const form = document.getElementById('adminChangePasswordForm');
			const submitBtn = form ? form.querySelector('button[type="submit"]') : null;
			const passwordInput = document.getElementById('password');
			const confirmInput = document.getElementById('confirm_password');
			const matchError = document.getElementById('match-error');

			if (passwordInput && confirmInput && matchError) {
				const toggleMatchState = () => {
					if (confirmInput.value && confirmInput.value !== passwordInput.value) {
						matchError.classList.remove('hidden');
						if (submitBtn) submitBtn.disabled = true;
					} else {
						matchError.classList.add('hidden');
						if (submitBtn) submitBtn.disabled = false;
					}
				};

				passwordInput.addEventListener('input', toggleMatchState);
				confirmInput.addEventListener('input', toggleMatchState);
			}

			if (form && submitBtn) {
				form.addEventListener('submit', () => {
					submitBtn.disabled = true;
					submitBtn.innerText = 'Memproses...';
				});
			}
		</script>
	</body>
</html>
