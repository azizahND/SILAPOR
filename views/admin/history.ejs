<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Riwayat Laporan Selesai</title>

    <!-- Tailwind & Preline -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/preline/dist/preline.js"></script>

    <!-- Fonts & Icons -->
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />
  </head>

  <body class="bg-gray-100 dark:bg-neutral-900 flex font-[Inter]">
    <!-- Sidebar -->
    <%- include('../components/sidebar') %>

    <!-- Konten Utama -->
    <main class="flex-1 ml-64 p-8 transition-all duration-300">
      <div
        class="bg-white dark:bg-neutral-800 rounded-2xl border border-gray-200 dark:border-neutral-700 overflow-hidden shadow-sm max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12 my-10"
      >
        <!-- Header dan Filter -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
          <h2 class="text-2xl font-semibold text-gray-800 dark:text-white">
            Riwayat Laporan Selesai
          </h2>

          <form
            method="GET"
            action="/mahasiswa/history"
            class="flex flex-col md:flex-row items-start md:items-center gap-4"
          >
            <select
              name="filterJenis"
              class="rounded-lg border p-2 bg-yellow-500 text-white border-2 border-orange-500 dark:bg-neutral-700 dark:border-neutral-600 dark:text-white"
            >
              <option value="">Semua Jenis</option>
              <option
                class="bg-white text-black"
                value="Penemuan"
                <%= filterJenis === 'Penemuan' ? 'selected' : '' %>>
                Penemuan
              </option>
              <option
                class="bg-white text-black"
                value="Kehilangan"
                <%= filterJenis === 'Kehilangan' ? 'selected' : '' %>>
                Kehilangan
              </option>
            </select>

            <input
              type="text"
              name="searchNama"
              placeholder="Cari nama barang..."
              value="<%= searchNama %>"
              class="rounded-lg border-2 border-gray-300 p-2 flex-1 dark:bg-neutral-700 dark:border-neutral-600 dark:text-white"
            />

            <button
              type="submit"
              class="bg-blue-500 text-white border-2 border-blue-500 px-4 py-2 rounded-lg hover:font-bold transition"
            >
              Cari / Filter
            </button>
          </form>
        </div>

        <div
          class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8"
        >
          <!-- Penemuan -->
          <div
            class="bg-white dark:bg-neutral-800 rounded-2xl p-6 shadow-lg border border-gray-200 dark:border-neutral-700 hover:scale-105 hover:shadow-xl transition duration-300"
          >
            <div class="flex items-center">
              <div
                class="w-12 h-12 bg-green-100 dark:bg-green-900/30 rounded-xl flex items-center justify-center mr-4"
              >
                <i class="fas fa-search text-green-600 dark:text-green-400"></i>
              </div>
              <div>
                <h3
                  class="text-2xl font-bold text-gray-900 dark:text-white"
                >
                  <%= reports.filter(r => r.jenis_laporan === 'Penemuan').length %>
                </h3>
                <p class="text-gray-600 dark:text-gray-400">Penemuan</p>
              </div>
            </div>
          </div>

          <!-- Kehilangan -->
          <div
            class="bg-white dark:bg-neutral-800 rounded-2xl p-6 shadow-lg border border-gray-200 dark:border-neutral-700 hover:scale-105 hover:shadow-xl transition duration-300"
          >
            <div class="flex items-center">
              <div
                class="w-12 h-12 bg-red-100 dark:bg-red-900/30 rounded-xl flex items-center justify-center mr-4"
              >
                <i
                  class="fas fa-exclamation text-red-600 dark:text-red-400"
                ></i>
              </div>
              <div>
                <h3
                  class="text-2xl font-bold text-gray-900 dark:text-white"
                >
                  <%= reports.filter(r => r.jenis_laporan === 'Kehilangan').length %>
                </h3>
                <p class="text-gray-600 dark:text-gray-400">Kehilangan</p>
              </div>
            </div>
          </div>

          <!-- Total -->
          <div
            class="bg-white dark:bg-neutral-800 rounded-2xl p-6 shadow-lg border border-gray-200 dark:border-neutral-700 hover:scale-105 hover:shadow-xl transition duration-300"
          >
            <div class="flex items-center">
              <div
                class="w-12 h-12 bg-blue-100 dark:bg-blue-900/30 rounded-xl flex items-center justify-center mr-4"
              >
                <i class="fas fa-list text-blue-600 dark:text-blue-400"></i>
              </div>
              <div>
                <h3
                  class="text-2xl font-bold text-gray-900 dark:text-white"
                >
                  <%= reports.length %>
                </h3>
                <p class="text-gray-600 dark:text-gray-400">Total Laporan</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Card Riwayat -->
        <div
          class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mt-10"
        >
          <% reports.forEach(report => { %>
            <div
              class="relative bg-white dark:bg-neutral-800 rounded-2xl border-2 border-gray-200 dark:border-neutral-700 overflow-hidden shadow-md hover:shadow-xl transition-shadow duration-300"
            >
              <!-- Jenis Laporan -->
              <div class="absolute top-4 left-4 z-10">
                <% if (report.jenis_laporan === "Penemuan") { %>
                  <span
                    class="bg-lime-100 text-lime-800 text-xs font-bold p-1 rounded dark:bg-green-200 dark:text-green-900"
                    >Penemuan</span
                  >
                <% } else { %>
                  <span
                    class="bg-yellow-100 text-yellow-800 text-xs font-bold p-1 rounded dark:bg-red-200 dark:text-red-900"
                    >Kehilangan</span
                  >
                <% } %>
              </div>

              <!-- Gambar -->
              <img
                src="/uploads/<%= report.foto_barang %>"
                alt="<%= report.nama_barang %>"
                class="w-full h-48 object-cover"
              />

              <!-- Detail -->
              <div class="p-6">
                <h3
                  class="text-lg font-semibold text-gray-800 dark:text-white mb-2"
                >
                  <%= report.nama_barang %>
                </h3>
                <p class="text-sm text-gray-600 dark:text-neutral-400 mb-4">
                  Dilaporkan pada:
                  <%= new Date(report.createdAt).toLocaleDateString('id-ID', { day: 'numeric', month: 'long', year: 'numeric' }) %>
                </p>
                <p class="text-gray-700 dark:text-neutral-300">
                  <%= report.deskripsi || "Tidak ada deskripsi" %>
                </p>
              </div>

              <!-- Tombol -->
              <div
                class="grid grid-cols-2 justify-center text-center mb-5 gap-3 px-5"
              >
                <button
                  class="bg-green-600 rounded-md text-white p-2 detail-btn"
                  data-id="<%= report.id_laporan %>"
                  data-nama="<%= report.nama_barang %>"
                  data-jenis="<%= report.jenis_laporan %>"
                  data-tanggal="<%= new Date(report.tanggal_kejadian).toLocaleDateString('id-ID') %>"
                  data-lokasi="<%= report.lokasi %>"
                  data-deskripsi="<%= report.deskripsi %>"
                  data-foto="/uploads/<%= report.foto_barang %>"
                >
                  <i class="fas fa-eye mr-2"></i>Detail
                </button>

                <a
                  href="/admin/history/download/<%= report.id_laporan %>"
                  class="bg-blue-500 rounded-md text-white p-2 block text-center"
                >
                  <i class="fa fa-download mr-2"></i>Unduh
                </a>
              </div>
            </div>
          <% }) %>
        </div>
      </div>
    </main>

    <!-- Modal -->
    <div
      id="detailModal"
      class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50"
    >
      <div
        class="bg-white dark:bg-neutral-800 rounded-2xl p-6 max-w-lg w-full relative"
      >
        <button
          id="closeModal"
          class="absolute top-7 right-6 text-red-500 hover:text-gray-800 bg-red-100 p-1 rounded-md font-bold"
        >
          âœ•
        </button>
        <h2
          class="text-xl font-bold mb-5 text-gray-800 dark:text-white"
        >
          Detail Laporan
        </h2>

        <div class="space-y-3">
          <div>
            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300"
              >Nama Barang</label
            >
            <input
              id="modalNama"
              type="text"
              readonly
              class="w-full rounded-lg border-2 p-2 mt-1 border-gray-400 dark:border-neutral-600 dark:bg-neutral-700 dark:text-white"
            />
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300"
              >Jenis Laporan</label
            >
            <input
              id="modalJenis"
              type="text"
              readonly
              class="w-full rounded-lg border-2 p-2 mt-1 border-gray-400 dark:border-neutral-600 dark:bg-neutral-700 dark:text-white"
            />
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300"
              >Tanggal Kejadian</label
            >
            <input
              id="modalTanggal"
              type="text"
              readonly
              class="w-full rounded-lg border-2 p-2 mt-1 border-gray-400 dark:border-neutral-600 dark:bg-neutral-700 dark:text-white"
            />
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300"
              >Lokasi</label
            >
            <input
              id="modalLokasi"
              type="text"
              readonly
              class="w-full rounded-lg border-2 p-2 mt-1 border-gray-400 dark:border-neutral-600 dark:bg-neutral-700 dark:text-white"
            />
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300"
              >Deskripsi</label
            >
            <textarea
              id="modalDeskripsi"
              rows="3"
              readonly
              class="w-full rounded-lg border-2 p-2 mt-1 border-gray-400 dark:border-neutral-600 dark:bg-neutral-700 dark:text-white"
            ></textarea>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300"
              >Foto Barang</label
            >
            <img
              id="modalFoto"
              src=""
              alt="Foto Barang"
              class="w-full h-48 object-cover rounded-lg mt-1"
            />
          </div>
        </div>
      </div>
    </div>

    <script>
      const modal = document.getElementById("detailModal");
      const closeModal = document.getElementById("closeModal");

      document.querySelectorAll(".detail-btn").forEach((btn) => {
        btn.addEventListener("click", () => {
          document.getElementById("modalNama").value = btn.dataset.nama;
          document.getElementById("modalJenis").value = btn.dataset.jenis;
          document.getElementById("modalTanggal").value = btn.dataset.tanggal;
          document.getElementById("modalLokasi").value = btn.dataset.lokasi;
          document.getElementById("modalDeskripsi").value = btn.dataset.deskripsi;
          document.getElementById("modalFoto").src = btn.dataset.foto;
          modal.classList.remove("hidden");
        });
      });

      closeModal.addEventListener("click", () => modal.classList.add("hidden"));
      modal.addEventListener("click", (e) => {
        if (e.target === modal) modal.classList.add("hidden");
      });
    </script>
  </body>
</html>
